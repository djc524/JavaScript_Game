<!DOCTYPE html>
<head>
    <title>JavaScript Game</title>
	<link rel="stylesheet" type="text/css" href="new.css"/>
</head>
<body>
  <img id="myImage" src="goo.png" style="display: none;">
<div class = 'align'>
    
    <canvas id="myCanvas" width="480" height="320"></canvas>
    
    <canvas id="leaderboard" width="120" height="320"></canvas>
	
	
    
</div>

<div class = "slider">
<input type="range" min="0" max="10" value="10" class="slider" id="myslider">
</div>
<script type="text/javascript" src="LeaderBoard.json"></script>
<script>
	// JavaScript code goes here
    
     
    var canvas = document.getElementById("myCanvas");
    var game = canvas.getContext("2d");
	var sep = canvas.getContext("2d");
	
	
	    //initial ball placement
    var x = canvas.width/2;
    var y = canvas.height-30;
	
	// Button checks
    var rightPressed = false;
    var leftPressed = false;
    var upPressed = false;
    var downPressed = false;
    var zPressed = false;
    var pushed = false;
	
	//timer stuff
	var theTimer = setInterval(Timer, 1000);
	var timeSeconds = 0;
	
	
	
	
	//playing music
	var audio = new Audio('coolsong.mp4');
	audio.play();
	audio.loop = true;
	
	//slider change
	myslider.addEventListener("change", function() {
    audio.volume = myslider.value/10;
	}, false);
	
	
	//ball color and stuff
    var ballRadius = 10;

     function ballMovement(){
      
	  //make player ball
	    
        game.beginPath();
        game.arc(x, y, ballRadius, 0, Math.PI*2);
        game.fillStyle = "red";
        game.fill();
        game.closePath();
		
		
		
		//making it sprite
		/*game.beginPath();
		game.drawImage(img,x,y,ballRadius*4,ballRadius*4);
		game.closePath();
		*/
    }

    //bullet stuff
    var wait = 0;
    var interval = 0;
    const bulletArray = [];       
    const playerArray = [];   

    // Bullet Pattern stuff
    // Bullets are (Radius, x position, y position, color, pattern ,x speed, y speed, breakable)

    // 1 = straight 2 = diagonal right 3 = diagonal left 4 = enemy 5 = tracking 9 = dummy


    function Bullet(){
        var i = 0
        while (i < bulletArray.length){
            game.beginPath();
            game.arc(bulletArray[i][1], bulletArray[i][2], bulletArray[i][0], 0, Math.PI*2);
            game.fillStyle = bulletArray[i][3];
            game.fill();
            game.closePath();
            i++;
        }
    }

    function playerBullet(){
        var i = 0
        while (i < playerArray.length){
            game.beginPath();
            game.arc(playerArray[i][1], playerArray[i][2], playerArray[i][0], 0, Math.PI*2);
            game.fillStyle = playerArray[i][3];
            game.fill();
            game.closePath();
            i++;
        }
    }
	
    function Collision(){
        var i = 0
            while (i < bulletArray.length){
                if (x > (bulletArray[i][1] - bulletArray[i][0]) && x < (bulletArray[i][0] + bulletArray[i][1])) {
        
                    if (y > (bulletArray[i][2] - bulletArray[i][0]) && y < (bulletArray[i][0] + bulletArray[i][2])) {

                    alert("GAME OVER");
                    document.location.reload();
                    clearInterval(interval); // Needed for Chrome to end game
                    }
                }

                //if (bulletArray[i][7] == 1){
                var j = 0
                while (j < playerArray.length){
                    if (playerArray[j][1] > (bulletArray[i][1] - bulletArray[i][0]) && playerArray[j][1] < (bulletArray[i][0] + bulletArray[i][1])) {
        
                        if (playerArray[j][2] > (bulletArray[i][2] - bulletArray[i][0]) && playerArray[j][2] < (bulletArray[i][0] + bulletArray[i][2])) {

                        bulletArray[i][4] = 9;
                        playerArray[j][4] = 9;
                        console.log("yeet");

                        }
                    }
                j++;
                }
                //}

            i++;
            }
        }

    function bulletMovement(){
        var i = 0
            while (i < bulletArray.length){

            // straight
                if (bulletArray[i][4] == 1){

                    bulletArray[i][1] += bulletArray[i][5]
                    bulletArray[i][2] += bulletArray[i][6]

                }

                if (bulletArray[i][4] == 2){

                    bulletArray[i][1] = canvas.width/2 + (bulletArray[i][5] * (200*Math.sin(bulletArray[i][2]/40)));
                    bulletArray[i][2] += bulletArray[i][6]

                }
 
            // replace with tracking bullet if time is multiple of 2
                else if (bulletArray[i][4] == 4){

                    bulletArray[i][2] += 2
                    if (timeSeconds > bulletArray[i][5]){

                    var vx = x - bulletArray[i][1];
                    var vy = y - bulletArray[i][2];

                    var dist = Math.sqrt(vx * vx + vy * vy);
                    var dx = vx / dist;
                    var dy = vy / dist;


                    bulletArray.push([15,bulletArray[i][1],bulletArray[i][2],"black",5,dx,dy]);
                    bulletArray[i][4] = 9;
                    }
                }

            // tracking bullet with 4
                else if (bulletArray[i][4] == 5){

                    bulletArray[i][1] += bulletArray[i][5] * 3
                    bulletArray[i][2] += bulletArray[i][6] * 3
                }


            // dummy empty bullet
                else if (bulletArray[i][4] == 9){

                    bulletArray[i][1] = -100
                    bulletArray[i][2] = -100
                    bulletArray[i][3] = "white"
                }
                i++;
            }

            var i = 0
            while (i < playerArray.length){
                if (playerArray[i][4] == 1){
                    playerArray[i][2] -= 5
                }
                else if (playerArray[i][4] == 9){

                    playerArray[i][1] = -100
                    playerArray[i][2] = -100
                    playerArray[i][3] = "white"
                }
                i++;
            }

    }

    // determines if there will be a pattern and which pattern it will be each second
    function randomBullet(){
        if (wait == 0){
            interval = Math.floor(Math.random() * 2) + (timeSeconds + 1);

            pattern = Math.floor(Math.random() * 7) + 1;
            /*
            if (timeSeconds < 10) {
                pattern = Math.floor(Math.random() * 3) + 1;
            }
            else if (timeSeconds < 20) {
                pattern = Math.floor(Math.random() * 6) + 1;
            }
            else {
                pattern = Math.floor(Math.random() * 9) + 1;
            }          
            */
            wait = 1;
        }

        if (timeSeconds == interval){
        //pattern = 1;

        // Bullets are (Radius, x position, y position, color, pattern ,x speed, y speed, breakable)

        // 2 diagonal and one enemy/tracking bullet
            if (pattern == 1){
                bulletArray.push([15,canvas.width/2,0,"gray",4,timeSeconds]);
                bulletArray.push([15,canvas.width/2,0,"blue",1,3,3,0]);
                bulletArray.push([15,canvas.width/2,0,"blue",1,-3,3,0]);
            }
        // 5 straight shots
            else if (pattern == 2){
                bulletArray.push([15,canvas.width/6,0,"green",1,0,5,0]);
                bulletArray.push([15,canvas.width/6*2,0,"green",1,0,5,0]);
                bulletArray.push([15,canvas.width/6*3,0,"green",1,0,5,0]);
                bulletArray.push([15,canvas.width/6*4,0,"green",1,0,5,0]);
                bulletArray.push([15,canvas.width/6*5,0,"green",1,0,5,0]);
            }
        // 4 diagonals
            else if (pattern == 3){
                bulletArray.push([15,0,0,"blue",1,3,3,0]);
                bulletArray.push([15,canvas.width,0,"blue",1,-3,3,0]);
                bulletArray.push([15,canvas.width/4,0,"blue",1,3,3,0]);
                bulletArray.push([15,canvas.width/4*3,0,"blue",1,-3,3,0]);
            }

        // harder patterns
            else if (pattern == 4){
                bulletArray.push([15,0,0,"gray",4,timeSeconds]);
                bulletArray.push([15,canvas.width,0,"gray",4,timeSeconds]);
                bulletArray.push([15,canvas.width/4,0,"gray",4,timeSeconds]);
                bulletArray.push([15,canvas.width/4*3,0,"gray",4,timeSeconds]);         
            }
            else if (pattern == 5){
                bulletArray.push([30,0,0,"purple",1,2,0,0]);
                bulletArray.push([30,canvas.width,canvas.height/6,"purple",1,-2,0,0]);
                bulletArray.push([30,0,canvas.height/6*2,"purple",1,2,0,0]);
                bulletArray.push([30,canvas.width,canvas.height/6*3,"purple",1,-2,0,0]);
                bulletArray.push([30,0,canvas.height/6*4,"purple",1,2,0,0]);
                bulletArray.push([30,canvas.width,canvas.height/6*5,"purple",1,-2,0,0]);
                bulletArray.push([30,0,canvas.height,"purple",1,2,0,0]);
            }
            else if (pattern == 6){
                bulletArray.push([15,0,0,"blue",1,3,3,0]);
                bulletArray.push([15,canvas.width,0,"blue",1,-3,3,0]);
                bulletArray.push([15,canvas.width/3,0,"blue",1,3,3,0]);
                bulletArray.push([15,canvas.width/3*2,0,"blue",1,-3,3,0]);
                bulletArray.push([15,canvas.width/2,0,"blue",1,-3,3,0]);

                bulletArray.push([15,0,0,"blue",1,-3,3,0]);
                bulletArray.push([15,canvas.width,0,"blue",1,3,3,0]);
                bulletArray.push([15,canvas.width/3,0,"blue",1,-3,3,0]);
                bulletArray.push([15,canvas.width/3*2,0,"blue",1,3,3,0]);
                bulletArray.push([15,canvas.width/2,0,"blue",1,3,3,0]);
            }
            else if (pattern == 7){
                bulletArray.push([30,canvas.width/2,0,"purple",2,1,1,0]);
                bulletArray.push([30,canvas.width/2,0,"purple",2,-1,1,0]);
            }

            wait = 0;
        }
    }

	
	//timer count function
	function Timer(){
		timeSeconds++;
	}
	
	//displaying timer
	function drawTime(){
	sep.fillStyle = "black";
	sep.font = "bold 18px Brush Script MT";
	sep.fillText(timeSeconds, 13, canvas.height - 13);
	}
	
	
    
    function draw() {
    // drawing code
	
	
	game.clearRect(0,0, canvas.width, canvas.height);
	
    randomBullet();
	ballMovement();
    Bullet();
    playerBullet();

	drawTime();
        if(rightPressed) {
            x += 5;
            if (x + ballRadius > canvas.width){
            x = canvas.width - ballRadius;
            }
        }
        else if(leftPressed) {
            x -= 5;
            if (x - ballRadius < 0){
            x = ballRadius;
            }
        }
        if(upPressed) {
            y -= 5;
            if (y - ballRadius < 0){
            y = ballRadius;
            }
        }
        else if(downPressed) {
            y += 5;
            if (y + ballRadius > canvas.height){
            y = canvas.height - ballRadius;
            }
        }
        if(zPressed){
            if (pushed == false){
                playerArray.push([5,x,y,"green",1]);
                pushed = true;
            }
        }
        else if (zPressed == false){
            pushed = false;
        }

        bulletMovement();
        Collision();
        
        //console.log(rightPressed);
	
    }


    
    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);

    function keyDownHandler(e) {
        if(e.key == "Right" || e.key == "ArrowRight") {
            rightPressed = true;
        }
        else if(e.key == "Left" || e.key == "ArrowLeft") {
            leftPressed = true;
        }

        if(e.key == "Up" || e.key == "ArrowUp") {
            upPressed = true;
        }
        else if(e.key == "Down" || e.key == "ArrowDown") {
            downPressed = true;
        }

        if(e.key == "Z" || e.key == "z") {
            zPressed = true;
        }
    }

    function keyUpHandler(e) {
        if(e.key == "Right" || e.key == "ArrowRight") {
            rightPressed = false;
        }
        else if(e.key == "Left" || e.key == "ArrowLeft") {
            leftPressed = false;
        }

        if(e.key == "Up" || e.key == "ArrowUp") {
            upPressed = false;
        }
        else if(e.key == "Down" || e.key == "ArrowDown") {
            downPressed = false;
        }

        if(e.key == "Z" || e.key == "z") {
            zPressed = false;
        }
    }

    



    var interval = setInterval(draw, 10);
	
	
	
	// LeaderBoard Section
	var canvas2 = document.getElementById("leaderboard");
	var cani = canvas2.getContext("2d");
	var mydata = JSON.parse(data);
	
	 function draw2() {
	  cani.beginPath();
	cani.fillText(mydata[0].name, 13, 13);
	cani.fillText(mydata[0].Time, 45, 13);
	 cani.closePath();
	}
	setInterval(draw2, 10);
	
</script>    
    
    
</body>